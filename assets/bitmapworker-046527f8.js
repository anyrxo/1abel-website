(function(){"use strict";const c={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class L{constructor(e,o,u){const i=this;let s=!1,a=0,f=0,h;const t=[];this.onStart=void 0,this.onLoad=e,this.onProgress=o,this.onError=u,this.itemStart=function(n){f++,s===!1&&i.onStart!==void 0&&i.onStart(n,a,f),s=!0},this.itemEnd=function(n){a++,i.onProgress!==void 0&&i.onProgress(n,a,f),a===f&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(n){i.onError!==void 0&&i.onError(n)},this.resolveURL=function(n){return h?h(n):n},this.setURLModifier=function(n){return h=n,this},this.addHandler=function(n,d){return t.push(n,d),this},this.removeHandler=function(n){const d=t.indexOf(n);return d!==-1&&t.splice(d,2),this},this.getHandler=function(n){for(let d=0,A=t.length;d<A;d+=2){const l=t[d],H=t[d+1];if(l.global&&(l.lastIndex=0),l.test(n))return H}return null}}}const O=new L;class m{constructor(e){this.manager=e!==void 0?e:O,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,o){const u=this;return new Promise(function(i,s){u.load(e,i,o,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}m.DEFAULT_MATERIAL_NAME="__DEFAULT";class p extends m{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,o,u,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=c.get(e);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(t=>{o&&o(t),s.manager.itemEnd(e)}).catch(t=>{i&&i(t)});return}return setTimeout(function(){o&&o(a),s.manager.itemEnd(e)},0),a}const f={};f.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",f.headers=this.requestHeader;const h=fetch(e,f).then(function(t){return t.blob()}).then(function(t){return createImageBitmap(t,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(t){return c.add(e,t),o&&o(t),s.manager.itemEnd(e),t}).catch(function(t){i&&i(t),c.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});c.add(e,h),s.manager.itemStart(e)}}const g=new p;g.setOptions({premultiplyAlpha:"none",imageOrientation:"flipY"});const E=new p;E.setOptions({premultiplyAlpha:"none",imageOrientation:"none"}),onmessage=r=>{(r.data.flipY?g:E).load(r.data.url,e=>{postMessage({bitmap:e},[e])},null,()=>{postMessage({error:!0})})}})();
